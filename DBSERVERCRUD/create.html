<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <title>Document</title>
    <style>
      #app {
        margin: auto;
        width: 400px;
        height: 500px;
        box-shadow: 2px 3px 3px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <h2>학생 주가</h2>
      <div>학번</div>
      <input type="text" v-model="id" />
      <div>이름</div>
      <input type="text" v-model="name" />
      <div>학과</div>
      <input type="text" v-model="dept" />
      <div>학년</div>
      <div>
        <select type="text" v-model="grade">
          <option value="1">1학년</option>
          <option value="2">2학년</option>
          <option value="3">3학년</option>
        </select>
      </div>
      <div>
        <label
          ><input
            name="gender"
            type="radio"
            v-model="gender"
            value="M"
          />남자</label
        >
        <label
          ><input
            name="gender"
            type="radio"
            v-model="gender"
            value="L"
          />여자</label
        >
      </div>
      <button @click="fnInsert">제출</button>
    </div>
  </body>
  <script>
    const app = Vue.createApp({
      data() {
        return {
          idchk: [],
          id: "",
          name: "",
          dept: "",
          grade: "",
          gender: "",
        };
      },

      methods: {
        plaseid() {
          var self = this;
          $.ajax({
            url: `http://localhost:3000/plsid`,
            dataType: "json",
            type: "GET",
            data: {},
            success: function (data) {
              self.idchk = data;
            },
          });
        },
        fnInsert() {
          var self = this;
          if (
            self.id == "" ||
            self.name == "" ||
            self.dept == "" ||
            self.grade == "" ||
            self.gender == ""
          ) {
            alert("빈 칸 없이 입력해 주세요.");
            return;
          } else if (self.id == idchk) {
            alert("이미 있는 학번입니다.");
            return;
          }
          if (!confirm("제출 하시겠습니까?")) {
            return;
          }
          $.ajax({
            url: `http://localhost:3000/insert?id=${self.id}&name=${self.name}&dept=${self.dept}&grade=${self.grade}&gender=${self.gender}`,
            dataType: "json",
            type: "GET",
            data: {},
            success: function (data) {
              self.id = "";
              self.name = "";
              self.dept = "";
              self.grade = "";
              self.gender = "";
              alert(data.message);
            },
          });
        },
      },
      mounted() {
        this.plaseid();
        console.log(this.idchk);
      },
    });
    app.mount("#app");
  </script>
</html>
